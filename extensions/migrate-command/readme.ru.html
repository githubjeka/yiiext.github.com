<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="language" content="en" />

	<!-- blueprint CSS framework -->
	<link rel="stylesheet" type="text/css" href="/css/main.css" />
	<link rel="stylesheet" type="text/css" href="/css/screen.css" media="screen, projection" />
	<link rel="stylesheet" type="text/css" href="/css/print.css" media="print" />
	<!--[if lt IE 8]>
	<link rel="stylesheet" type="text/css" href="/css/ie.css" media="screen, projection" />
	<![endif]-->

	<link rel="stylesheet" type="text/css" href="/css/web.css" />
	<link rel="stylesheet" type="text/css" href="/css/form.css" />

	<title>yiiext - RepoReadme Site</title>
</head>

<body>

<a href="https://github.com/yiiext/migrate-command"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/assets.github.com/img/7afbc8b248c68eb468279e8c17986ad46549fb71/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub"></a>

<div class="container" id="page">

	<div id="header">
        <div class="extensions-count"><b>53</b> great Yii extensions!</div>
		<div id="logo">
            <h1>yiiext</h1>
            unofficial Yii extension repository
        </div>
	</div><!-- header -->

	<div id="mainmenu">
		<ul id="yw0">
<li><a href="/index.html">Extensions</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/contact.html">Contact</a></li>
</ul>
	</div><!-- mainmenu -->

    <div id="content">
        <div id="repo">
            <h1>Extended Migration Command</h1>

<p>Данное расширение — расширенная версия <a href="http://www.yiiframework.com/doc/guide/1.1/ru/database.migration">миграций Yii</a>,
которая добавляет поддержку модулей и некоторые дополнительные возможности. Если у вас есть пожелания
или вы нашли ошибки, пишите <a href="https://github.com/yiiext/migrate-command/issues">в трекер проекта</a> или <a href="mailto:mail@cebe.cc">напрямую автору</a> (по-английски).</p>

<h2>Возможнсти</h2>

<ul>
<li>Поддержка модулей (миграции в отельных директориях для каждого модуля), а именно:

<ul>
<li>...включение и выключение модулей</li>
<li>...<a href="#hh8">добавить</a> новый модуль через migrate up</li>
<li>...<a href="#hh9">удалить</a> модуль через migratie down</li>
<li>...<a href="#hh7">выбрать модули</a> для которых будут применены миграции</li>
<li>...зависимости модулей (в планах)</li>
<li>...различные шаблоны для миграций различных модулей (в планах)</li>
</ul></li>
</ul>

<h2>Ссылки</h2>

<ul>
<li><a href="https://github.com/yiiext/migrate-command">GIT</a></li>
<li><a href="http://www.yiiframework.com/doc/guide/1.1/ru/database.migration">Документация по миграциям Yii</a></li>
<li><a href="http://www.yiiframework.com/forum/index.php?/topic/22471-extension-extended-database-migration/">Обсуждение</a></li>
<li><a href="https://github.com/yiiext/migrate-command/issues">Сообщить об ошибке или предложить функционал</a></li>
</ul>

<h2>Требования</h2>

<ul>
<li>Yii 1.1.6 и выше (именно в этой версии появились миграции)
если вы скопируете MigrateCommand и <a href="http://www.yiiframework.com/doc/api/1.1/CDbMigration">CDbMigration</a>,
то сможете использовать данное расширение с любой версией Yii.</li>
</ul>

<h2>Установка</h2>

<ul>
<li>Распаковать в <code>protected/extensions</code>.</li>
<li>Добавить следующее в <a href="http://www.yiiframework.com/doc/guide/1.1/ru/database.migration#customizing-migration-command">конфиг</a>:</li>
</ul>

<div class="hl-code"><div class="php-hl-main"><pre><span class="php-hl-quotes">'</span><span class="php-hl-string">commandMap</span><span class="php-hl-quotes">'</span><span class="php-hl-code"> =&gt; </span><span class="php-hl-reserved">array</span><span class="php-hl-brackets">(</span>
        <span class="php-hl-quotes">'</span><span class="php-hl-string">migrate</span><span class="php-hl-quotes">'</span><span class="php-hl-code"> =&gt; </span><span class="php-hl-reserved">array</span><span class="php-hl-brackets">(</span>
            <span class="php-hl-comment">//</span><span class="php-hl-comment"> псевдоним директории, в которую распаковано расширение</span>
            <span class="php-hl-quotes">'</span><span class="php-hl-string">class</span><span class="php-hl-quotes">'</span><span class="php-hl-code"> =&gt; </span><span class="php-hl-quotes">'</span><span class="php-hl-string">application.extensions.yiiext.commands.migrate.EMigrateCommand</span><span class="php-hl-quotes">'</span><span class="php-hl-code">,
            </span><span class="php-hl-comment">//</span><span class="php-hl-comment"> путь для хранения общих миграций</span>
            <span class="php-hl-quotes">'</span><span class="php-hl-string">migrationPath</span><span class="php-hl-quotes">'</span><span class="php-hl-code"> =&gt; </span><span class="php-hl-quotes">'</span><span class="php-hl-string">application.db.migrations</span><span class="php-hl-quotes">'</span><span class="php-hl-code">,
            </span><span class="php-hl-comment">//</span><span class="php-hl-comment"> имя таблицы с версиями</span>
            <span class="php-hl-quotes">'</span><span class="php-hl-string">migrationTable</span><span class="php-hl-quotes">'</span><span class="php-hl-code"> =&gt; </span><span class="php-hl-quotes">'</span><span class="php-hl-string">tbl_migration</span><span class="php-hl-quotes">'</span><span class="php-hl-code">,
            </span><span class="php-hl-comment">//</span><span class="php-hl-comment"> имя псевдомодуля для общих миграций. По умолчанию равно &quot;core&quot;.</span>
            <span class="php-hl-quotes">'</span><span class="php-hl-string">applicationModuleName</span><span class="php-hl-quotes">'</span><span class="php-hl-code"> =&gt; </span><span class="php-hl-quotes">'</span><span class="php-hl-string">core</span><span class="php-hl-quotes">'</span><span class="php-hl-code">,
            </span><span class="php-hl-comment">//</span><span class="php-hl-comment"> определяем все модули, для которых нужны миграции  (в противном случае, модули будут взяты из конфигурации Yii)</span>
            <span class="php-hl-quotes">'</span><span class="php-hl-string">modulePaths</span><span class="php-hl-quotes">'</span><span class="php-hl-code"> =&gt; </span><span class="php-hl-reserved">array</span><span class="php-hl-brackets">(</span>
                <span class="php-hl-quotes">'</span><span class="php-hl-string">admin</span><span class="php-hl-quotes">'</span><span class="php-hl-code">      =&gt; </span><span class="php-hl-quotes">'</span><span class="php-hl-string">application.modules.admin.db.migrations</span><span class="php-hl-quotes">'</span><span class="php-hl-code">,
                </span><span class="php-hl-quotes">'</span><span class="php-hl-string">user</span><span class="php-hl-quotes">'</span><span class="php-hl-code">       =&gt; </span><span class="php-hl-quotes">'</span><span class="php-hl-string">application.modules.user.db.migrations</span><span class="php-hl-quotes">'</span><span class="php-hl-code">,
                </span><span class="php-hl-quotes">'</span><span class="php-hl-string">yourModule</span><span class="php-hl-quotes">'</span><span class="php-hl-code"> =&gt; </span><span class="php-hl-quotes">'</span><span class="php-hl-string">application.any.other.path.possible</span><span class="php-hl-quotes">'</span><span class="php-hl-code">,
                </span><span class="php-hl-comment">//</span><span class="php-hl-comment"> ...</span>
            <span class="php-hl-brackets">)</span><span class="php-hl-code">,
            </span><span class="php-hl-comment">//</span><span class="php-hl-comment"> отключаем некоторые модули</span>
            <span class="php-hl-quotes">'</span><span class="php-hl-string">disabledModules</span><span class="php-hl-quotes">'</span><span class="php-hl-code"> =&gt; </span><span class="php-hl-reserved">array</span><span class="php-hl-brackets">(</span>
                <span class="php-hl-quotes">'</span><span class="php-hl-string">admin</span><span class="php-hl-quotes">'</span><span class="php-hl-code">, </span><span class="php-hl-quotes">'</span><span class="php-hl-string">anOtherModule</span><span class="php-hl-quotes">'</span><span class="php-hl-code">, </span><span class="php-hl-comment">//</span><span class="php-hl-comment"> ...</span>
            <span class="php-hl-brackets">)</span><span class="php-hl-code">,
            </span><span class="php-hl-comment">//</span><span class="php-hl-comment"> название компонента для подключения к базе данных</span>
            <span class="php-hl-quotes">'</span><span class="php-hl-string">connectionID</span><span class="php-hl-quotes">'</span><span class="php-hl-code">=&gt;</span><span class="php-hl-quotes">'</span><span class="php-hl-string">db</span><span class="php-hl-quotes">'</span><span class="php-hl-code">,
            </span><span class="php-hl-comment">//</span><span class="php-hl-comment"> алиас шаблона для новых миграций</span>
            <span class="php-hl-quotes">'</span><span class="php-hl-string">templateFile</span><span class="php-hl-quotes">'</span><span class="php-hl-code">=&gt;</span><span class="php-hl-quotes">'</span><span class="php-hl-string">application.db.migration_template</span><span class="php-hl-quotes">'</span><span class="php-hl-code">,
        </span><span class="php-hl-brackets">)</span><span class="php-hl-code">,
    </span><span class="php-hl-brackets">)</span><span class="php-hl-code">,</span></pre></div></div>

<p><strong>Важно:</strong> если вы уже использовали MigrateCommand, необходимо добавить столбец module в таблицу версий migrationTable:</p>

<div class="hl-code"><div class="sql-hl-main"><pre><span class="sql-hl-reserved">ALTER</span> <span class="sql-hl-reserved">TABLE</span> <span class="sql-hl-quotes">`</span><span class="sql-hl-identifier">tbl_migration</span><span class="sql-hl-quotes">`</span> <span class="sql-hl-reserved">ADD</span> <span class="sql-hl-reserved">COLUMN</span> <span class="sql-hl-quotes">`</span><span class="sql-hl-identifier">module</span><span class="sql-hl-quotes">`</span> <span class="sql-hl-reserved">varchar</span><span class="sql-hl-brackets">(</span><span class="sql-hl-number">32</span><span class="sql-hl-brackets">)</span> <span class="sql-hl-reserved">DEFAULT</span> <span class="sql-hl-reserved">NULL</span><span class="sql-hl-code">;
 </span><span class="sql-hl-reserved">UPDATE</span> <span class="sql-hl-quotes">`</span><span class="sql-hl-identifier">tbl_migration</span><span class="sql-hl-quotes">`</span> <span class="sql-hl-reserved">SET</span> <span class="sql-hl-reserved">module</span><span class="sql-hl-code">=</span><span class="sql-hl-quotes">'</span><span class="sql-hl-string">core</span><span class="sql-hl-quotes">'</span><span class="sql-hl-code">;</span></pre></div></div>

<h2>Использование</h2>

<h3>Обычное использование</h3>

<p>Для просмотра всех доступных параметров и коротких примеров по использованию можно
воспользоваться <code>yiic migrate help</code>.</p>

<p>Основы работы с миграциями описаны в <a href="http://www.yiiframework.com/doc/guide/1.1/ru/database.migration">официальном руководстве</a>.
Если вы не использовали миграции до этого момента, стоит начать именно с него.
Использование расширенной версии не сильно отличается от обычной.
Единственная отличная команда — это <a href="http://www.yiiframework.com/doc/guide/1.1/ru/database.migration#creating-migrations">create</a>,
для которой требуется указание имя модуля:</p>

<pre>   yiic migrate create modulename create_user_table
</pre>

<p>Команда, приведённая выше создаёт миграцию 'create_user_table' в модуле 'modulename'. Обычное использование</p>

<pre>   yiic migrate create create_user_table
</pre>

<p>создаёт общую миграцию 'create_user_table' (в псевдомодуле <code>core</code>).</p>

<h3>Параметр --module</h3>

<p>Во всех остальных командах (<code>up</code>, <code>down</code>, <code>history</code>, <code>new</code>, <code>to</code> и <code>mark</code>) можно использовать
параметр <code>--module=&lt;modulenames&gt;</code>, где <code>&lt;modulenames&gt;</code> — разделённый запятыми список
имён модулей, либо просто имя модуля. Данный параметр позволяет ограничить действие команды
определёнными модулями.
Примеры:</p>

<pre>   yiic migrate new --module=core
</pre>

<p>Покажет все общие миграции (для модуля <code>core</code>).</p>

<pre>   yiic migrate up 5 --module=core,user
</pre>

<p>Применит пять миграций в модулях <code>core</code> и <code>user</code>. Миграции остальных модулей будут
проигнорированы.</p>

<pre>   yiic migrate history --module=core,user
</pre>

<p>Покажет, какие миграции применены к модулям <code>core</code> и <code>user</code>.
Если не указать модуль, команда ведёт себя как та, что включена в Yii за тем исключением,
что применяется ещё и ко всем модулям.</p>

<h3>Добавление модуля</h3>

<p>Просто подключите модуль в файле конфигурации и запустите <code>yiic migrate up --module=yourModule</code>.</p>

<h3>Удаление модуля</h3>

<p>Запустите <code>yiic migrate to m000000_000000 --module=yourModule</code>. Для этого все миграции
должны реализовывать метод <code>down()</code>.</p>

    
    <h2 id="changelog">Changelog</h2>

    <h3>Changelog</h3>

<h4>0.7.1 (2012-01-31)</h4>

<ul>
<li>fix for getTable trying to hit a db cache and die in endless loop (cebe)</li>
</ul>

<h4>0.7.0 (2012-01-28)</h4>

<ul>
<li>adjusted sql commands to be compatible with nearly all pdo db systems (cebe)</li>
<li>modules are now loaded from yii application config if not set (cebe)</li>
<li>improved create action error handling (cebe)</li>
</ul>

<h4>0.6.0 (2011-09-12) not released, did not work</h4>

<ul>
<li>adjusted sql commands to be compatible with sqlite and postgres (cebe thanks to redguy)</li>
<li>added compatibility with CDbMigration, migrations need not extend EDbMigration (cebe)</li>
</ul>

<h4>0.5.0 (2011-08-09)</h4>

<ul>
<li>implemented mark-action so it now works with modules (cebe)</li>
<li>implemented to-action so it now works with modules (cebe)</li>
<li>fixed problem that base-migrations where not cretated on mark command (cebe)</li>
</ul>

<h4>0.4.0 (2011-08-08)</h4>

<ul>
<li>added confirm() method to EDbMigration (cebe)</li>
</ul>

<h4>0.3.1 (2011-08-05)</h4>

<ul>
<li>fixed a problem with finding new migrations (cebe)</li>
<li>added base migration for every single module (cebe)</li>
<li>fixed problem with history and down migration when --module parameter is set (cebe)</li>
<li>added $moduleDelimiter property and replaced string function with multibyte versions (cebe)</li>
<li>complete refactoring of basic functionality, more stability and more straight forward (cebe)</li>
</ul>

<h4>0.1.0 (2011-08-04)</h4>

<ul>
<li>Initial public release (cebe)</li>
<li>module support for migrations</li>
<li>extended execute() of CDbMigration with parameter $verbose</li>
</ul>


</div>

<div id="repo-sidebar">
    <div class="repo noreadme">
    <div class="repo-head">
        <h3><a href="/extensions/migrate-command/index.html">migrate-command</a></h3>
    </div>
    <p>This is an enhanced version of the Yii Database Migration Tool that adds module support and many more usefull features.</p>

    <div class="contributors">
            <a href="https://github.com/cebe" title="cebe">
            <img src="https://secure.gravatar.com/avatar/2ebfe57beabd0b9f8eb9ded1237a275d?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png" alt="cebe" style="height: 24px; width: 24px;"/>
        </a>
            <a href="https://github.com/samdark" title="samdark">
            <img src="https://secure.gravatar.com/avatar/c13375ba1016846e39bc0e48260d0bb1?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png" alt="samdark" style="height: 24px; width: 24px;"/>
        </a>
        </div>


    </div>


    <h2>Documentation</h2>
    <ul>
            <li><a href="/extensions/migrate-command/readme.en.html">readme en</a></li>
            <li><a href="/extensions/migrate-command/readme.ru.html">readme ru</a></li>
        <li><a href="/extensions/migrate-command/index.html#changelog">changelog </a></li>
    </ul>

    <h2>Downloads (Tags)</h2>
    <ul>
            <li>0.4.0 -
        <a href="https://github.com/yiiext/migrate-command/tarball/0.4.0">tar</a>,
        <a href="https://github.com/yiiext/migrate-command/zipball/0.4.0">zip</a>
        </li>
            <li>0.5.0 -
        <a href="https://github.com/yiiext/migrate-command/tarball/0.5.0">tar</a>,
        <a href="https://github.com/yiiext/migrate-command/zipball/0.5.0">zip</a>
        </li>
            <li>0.6.0 -
        <a href="https://github.com/yiiext/migrate-command/tarball/0.6.0">tar</a>,
        <a href="https://github.com/yiiext/migrate-command/zipball/0.6.0">zip</a>
        </li>
            <li>0.7.0 -
        <a href="https://github.com/yiiext/migrate-command/tarball/0.7.0">tar</a>,
        <a href="https://github.com/yiiext/migrate-command/zipball/0.7.0">zip</a>
        </li>
            <li>0.7.1 -
        <a href="https://github.com/yiiext/migrate-command/tarball/0.7.1">tar</a>,
        <a href="https://github.com/yiiext/migrate-command/zipball/0.7.1">zip</a>
        </li>
        </ul>

    <h2>Resources</h2>
    <ul>
        <li><a href="https://github.com/yiiext/migrate-command">Browse Code</a></li>
        <li><a href="https://github.com/yiiext/migrate-command/issues">Issues</a> (6)</li>        <li><a href="https://github.com/yiiext/migrate-command/wiki">Wiki</a></li>        <li>...</li>
    </ul>

</div>

<br style="clear: both;"/>


    </div>

    <div id="footer">
        Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a>.
    </div><!-- footer -->

</div><!-- page -->
</body>
</html>
